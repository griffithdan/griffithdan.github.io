<!-- Belongs at: /_includes/navigation.html -->

<!-- This finds the current page so it can be highlighted. -->

{% for entry in site.data.navigation %}
{% capture fullurl %}{{ site.baseurl }}{{ entry.url }}{% endcapture %}
    {% if fullurl == page.url %}
        {% assign current_page = fullurl %}
        {% break %}
    {% elsif page.url contains fullurl %}
        {% assign current_page = fullurl %}
    {% endif %}
{% endfor %}


 <nav class="navbar-collapse collapse" role="navigation">
              <ul class="nav navbar-nav navbar-right">
                  {% for entry in site.data.navigation %}
                  <li id="{{ entry.title | slugify }}">
                              {% assign sublinks = entry.sublinks %}
                              {% if sublinks %}
                      <a href="#" data-toggle="dropdown" class="dropdown-toggle">{{ entry.title }}<b class="caret"></b></a>
                      <ul class="dropdown-menu dropdown-left">
                          {% for subitem in entry.sublinks %}
                          {% if subitem.url contains "http" %}
                          {% assign target = "_blank" %}{% else %}
                          {% assign target = "_self" %}{% endif %}
                          <li><a href="{{ subitem.url }}" target="{{ target }}">{{ subitem.title }}</a></li>
                          {% endfor %}
                      </ul>
                      {% else %}
                      {% if entry.url contains "http" %}
                      {% assign target = "_blank" %}{% else %}
                      {% assign target = "_self" %}{% endif %}
                      <a href="{{ entry.url }}" target="{{ target }}">{{ entry.title }}</a>
                      {% endif %}
                  </li>
                  {% endfor %}
              </ul>
          </nav><!--/.navbar-collapse -->



<!-- Then we build the nav bar. -->
<nav>
    <ul>
    {% for entry in site.data.navigation %}
        {% if entry.url == current_page %}
            {% assign current = ' class="current"' %}
        {% else %}
            <!-- We have to declare it 'null' to ensure it doesn't propagate. -->
            {% assign current = null %}
        {% endif %}
        {% assign sublinks = entry.sublinks %}
        {% if sublinks %}
        <li{{ current }}>
            <a href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a>
            <ul>
                {% for sublink in sublinks %}
                <li><a href="{{ site.baseurl }}{{ sublink.url }}">{{ sublink.title }}</a></li>
                {% endfor %}
            </ul>
        </li>
        {% else %}
        <li{{ current }}><a href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a></li>
        {% endif %}
    {% endfor %}
    </ul>
</nav>
