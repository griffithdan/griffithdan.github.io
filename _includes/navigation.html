<!-- Belongs at: /_includes/navigation.html -->

<!-- This finds the current page so it can be highlighted. -->

{% for entry in site.data.navigation %}
  {% assign sublinks = entry.sublinks %}
  {% if sublinks %}
    {% for sublink in sublinks %}
      {% capture fullurl %}{{ site.baseurl }}{{ sublink.url }}{% endcapture %}
          {% if fullurl == page.url %}
              {% assign current_page = fullurl %}
              {% break %}
          {% elsif page.url contains fullurl %}
              {% assign current_page = fullurl %}
          {% endif %}
    {% endfor %}
  {% else %}
    {% capture fullurl %}{{ site.baseurl }}{{ entry.url }}{% endcapture %}
        {% if fullurl == page.url %}
            {% assign current_page = fullurl %}
            {% break %}
        {% elsif page.url contains fullurl %}
            {% assign current_page = fullurl %}
        {% endif %}
  {% endif %}
{% endfor %}


<!-- Then we build the nav bar. -->
<nav>
    <ul class="nav">
    {% for entry in site.data.navigation %}
        
        {% assign sublinks = entry.sublinks %}
        
        {% if sublinks %}
            
            <li>
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">{{ entry.title }}<b class="caret"></b></a>
                <!-- <a href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a> -->
                <ul class="dropdown-menu" data-role="dropdown">
                    {% for sublink in sublinks %}
                        {% if sublink.url contains "http" %}
                          {% assign target = "_blank" %}{% else %}
                          {% assign target = "_self" %}
                        {% endif %}
                        {% if sublink.url == current_page %}
                            {% assign current = ' class="current"' %}
                            {% else %}
                            {% assign current = null %}
                        {% endif %}
                        <li{{ current }}><a href="{{ site.baseurl }}{{ sublink.url }}" target="{{ target }}">{{ sublink.title }}</a></li>
                    {% endfor %}
                </ul>
            </li>
        {% else %}
            {% if entry.url == current_page %}
                {% assign current = ' class="current"' %}
                {% else %}
                    <!-- We have to declare it 'null' to ensure it doesn't propagate. -->
                    {% assign current = null %}
            {% endif %}
            <li{{ current }}><a href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a></li>
        {% endif %}
    {% endfor %}
    </ul>
</nav>

<script type="text/javascript">
$(document).ready(function() {
    // Initialize navgoco with default options
    $("#demo1").navgoco({
        caretHtml: '',
        accordion: false,
        openClass: 'open',
        save: true,
        cookie: {
            name: 'navgoco',
            expires: false,
            path: '/'
        },
        slide: {
            duration: 400,
            easing: 'swing'
        },
        // Add Active class to clicked menu item
        onClickAfter: active_menu_cb,
    });

    $("#collapseAll").click(function(e) {
        e.preventDefault();
        $("#demo1").navgoco('toggle', false);
    });

    $("#expandAll").click(function(e) {
        e.preventDefault();
        $("#demo1").navgoco('toggle', true);
    });
});
</script>
